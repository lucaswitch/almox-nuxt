import{u as ae}from"./auth.cb07611c.js";import{S as re,a as Q}from"./validation.977342dc.js";import{g as L}from"./formatter.b9064c7a.js";import{n as se,r as M,q as F,o as x,s as C,w as r,u as d,b as i,d as N,v as S,x as I,c as le,y as oe,F as ie,z as Z,t as ue,a as j}from"./entry.a8ea04dc.js";import{V as E,a as A}from"./VRow.be53b986.js";import{V as de}from"./VAlert.e1cd697c.js";import{V as z}from"./VBtn.fb6611c3.js";import{V as G,a as me}from"./VSnackbar.fda5ed2c.js";import{V as U}from"./VTextField.7b7381e2.js";import{V as ce,a as pe}from"./VList.a955bb07.js";import{V as he}from"./VForm.fdb6c9e3.js";import{V as fe,a as ve,b as ke}from"./VCard.73ffbd1f.js";import"./moment.fbc5633a.js";/* empty css              */import"./tag.19ec8209.js";import"./VImg.e08626a0.js";import"./forwardRefs.d6ed2341.js";import"./VMenu.61502ef3.js";import"./scopeId.280ebac7.js";import"./index.2e760ea7.js";import"./VAvatar.28b1b839.js";import"./ssrBoot.73ea425f.js";import"./VDivider.bce6a8e5.js";/*! maska v2.1.10 | (c) Alexander Shabunevich | Released under the MIT license */var ge=Object.defineProperty,ye=(s,t,e)=>t in s?ge(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,T=(s,t,e)=>(ye(s,typeof t!="symbol"?t+"":t,e),e);const K={"#":{pattern:/[0-9]/},"@":{pattern:/[a-zA-Z]/},"*":{pattern:/[a-zA-Z0-9]/}};class X{constructor(t={}){T(this,"opts",{}),T(this,"memo",new Map);const e={...t};if(e.tokens!=null){e.tokens=e.tokensReplace?{...e.tokens}:{...K,...e.tokens};for(const a of Object.values(e.tokens))typeof a.pattern=="string"&&(a.pattern=new RegExp(a.pattern))}else e.tokens=K;Array.isArray(e.mask)&&(e.mask.length>1?e.mask=[...e.mask].sort((a,l)=>a.length-l.length):e.mask=e.mask[0]??""),e.mask===""&&(e.mask=null),this.opts=e}masked(t){return this.process(t,this.findMask(t))}unmasked(t){return this.process(t,this.findMask(t),!1)}isEager(){return this.opts.eager===!0}isReversed(){return this.opts.reversed===!0}completed(t){const e=this.findMask(t);if(this.opts.mask==null||e==null)return!1;const a=this.process(t,e).length;return typeof this.opts.mask=="string"?a>=this.opts.mask.length:typeof this.opts.mask=="function"?a>=e.length:this.opts.mask.filter(l=>a>=l.length).length===this.opts.mask.length}findMask(t){const e=this.opts.mask;if(e==null)return null;if(typeof e=="string")return e;if(typeof e=="function")return e(t);const a=this.process(t,e.slice(-1).pop()??"",!1);return e.find(l=>this.process(t,l,!1).length>=a.length)??""}escapeMask(t){const e=[],a=[];return t.split("").forEach((l,u)=>{l==="!"&&t[u-1]!=="!"?a.push(u-a.length):e.push(l)}),{mask:e.join(""),escaped:a}}process(t,e,a=!0){var l;if(e==null)return t;const u=`value=${t},mask=${e},masked=${a?1:0}`;if(this.memo.has(u))return this.memo.get(u);const{mask:m,escaped:f}=this.escapeMask(e),k=[],_=this.opts.tokens!=null?this.opts.tokens:{},p=this.isReversed()?-1:1,y=this.isReversed()?"unshift":"push",w=this.isReversed()?0:m.length-1,$=this.isReversed()?()=>h>-1&&b>-1:()=>h<m.length&&b<t.length,c=Y=>!this.isReversed()&&Y<=w||this.isReversed()&&Y>=w;let R,q=-1,h=this.isReversed()?m.length-1:0,b=this.isReversed()?t.length-1:0;for(;$();){const Y=m.charAt(h),V=_[Y],D=(V==null?void 0:V.transform)!=null?V.transform(t.charAt(b)):t.charAt(b);if(!f.includes(h)&&V!=null){if(D.match(V.pattern)!=null)k[y](D),V.repeated?(q===-1?q=h:h===w&&h!==q&&(h=q-p),w===q&&(h-=p)):V.multiple&&(h-=p),h+=p;else if(V.multiple){const B=((l=k[b-p])==null?void 0:l.match(V.pattern))!=null,H=m.charAt(h+p);B&&H!==""&&_[H]==null?(h+=p,b-=p):k[y]("")}else D===R?R=void 0:V.optional&&(h+=p,b-=p);b+=p}else a&&!this.isEager()&&k[y](Y),D===Y&&!this.isEager()?b+=p:R=Y,this.isEager()||(h+=p);if(this.isEager())for(;c(h)&&(_[m.charAt(h)]==null||f.includes(h));)a?k[y](m.charAt(h)):m.charAt(h)===t.charAt(b)&&(b+=p),h+=p}return this.memo.set(u,k.join("")),this.memo.get(u)}}const ne=s=>JSON.parse(s.replaceAll("'",'"')),ee=(s,t={})=>{const e={...t};return s.dataset.maska!=null&&s.dataset.maska!==""&&(e.mask=_e(s.dataset.maska)),s.dataset.maskaEager!=null&&(e.eager=P(s.dataset.maskaEager)),s.dataset.maskaReversed!=null&&(e.reversed=P(s.dataset.maskaReversed)),s.dataset.maskaTokensReplace!=null&&(e.tokensReplace=P(s.dataset.maskaTokensReplace)),s.dataset.maskaTokens!=null&&(e.tokens=be(s.dataset.maskaTokens)),e},P=s=>s!==""?!!JSON.parse(s):!0,_e=s=>s.startsWith("[")&&s.endsWith("]")?ne(s):s,be=s=>{if(s.startsWith("{")&&s.endsWith("}"))return ne(s);const t={};return s.split("|").forEach(e=>{const a=e.split(":");t[a[0]]={pattern:new RegExp(a[1]),optional:a[2]==="optional",multiple:a[2]==="multiple",repeated:a[2]==="repeated"}}),t};class Ve{constructor(t,e={}){T(this,"items",new Map),T(this,"beforeinputEvent",a=>{const l=a.target,u=this.items.get(l);u.isEager()&&"inputType"in a&&a.inputType.startsWith("delete")&&u.unmasked(l.value).length<=1&&this.setMaskedValue(l,"")}),T(this,"inputEvent",a=>{if(a instanceof CustomEvent&&a.type==="input"&&a.detail!=null&&typeof a.detail=="object"&&"masked"in a.detail)return;const l=a.target,u=this.items.get(l),m=l.value,f=l.selectionStart,k=l.selectionEnd;let _=m;if(u.isEager()){const p=u.masked(m),y=u.unmasked(m);y===""&&"data"in a&&a.data!=null?_=a.data:y!==u.unmasked(p)&&(_=y)}if(this.setMaskedValue(l,_),"inputType"in a&&(a.inputType.startsWith("delete")||f!=null&&f<m.length))try{l.setSelectionRange(f,k)}catch{}}),this.options=e,typeof t=="string"?this.init(Array.from(document.querySelectorAll(t)),this.getMaskOpts(e)):this.init("length"in t?Array.from(t):[t],this.getMaskOpts(e))}destroy(){for(const t of this.items.keys())t.removeEventListener("input",this.inputEvent),t.removeEventListener("beforeinput",this.beforeinputEvent);this.items.clear()}needUpdateOptions(t,e){const a=this.items.get(t),l=new X(ee(t,this.getMaskOpts(e)));return JSON.stringify(a.opts)!==JSON.stringify(l.opts)}needUpdateValue(t){const e=t.dataset.maskaValue;return e==null&&t.value!==""||e!=null&&e!==t.value}getMaskOpts(t){const{onMaska:e,preProcess:a,postProcess:l,...u}=t;return u}init(t,e){for(const a of t){const l=new X(ee(a,e));this.items.set(a,l),a.value!==""&&this.setMaskedValue(a,a.value),a.addEventListener("input",this.inputEvent),a.addEventListener("beforeinput",this.beforeinputEvent)}}setMaskedValue(t,e){const a=this.items.get(t);this.options.preProcess!=null&&(e=this.options.preProcess(e));const l=a.masked(e),u=a.unmasked(a.isEager()?l:e),m=a.completed(e),f={masked:l,unmasked:u,completed:m};e=l,this.options.postProcess!=null&&(e=this.options.postProcess(e)),t.value=e,t.dataset.maskaValue=e,this.options.onMaska!=null&&(Array.isArray(this.options.onMaska)?this.options.onMaska.forEach(k=>k(f)):this.options.onMaska(f)),t.dispatchEvent(new CustomEvent("maska",{detail:f})),t.dispatchEvent(new CustomEvent("input",{detail:f}))}}const W=new WeakMap,Me=s=>{setTimeout(()=>{var t;((t=W.get(s))==null?void 0:t.needUpdateValue(s))===!0&&s.dispatchEvent(new CustomEvent("input"))})},te=(s,t)=>{const e=s instanceof HTMLInputElement?s:s.querySelector("input"),a={...t.arg};if(e==null||(e==null?void 0:e.type)==="file")return;Me(e);const l=W.get(e);if(l!=null){if(!l.needUpdateOptions(e,a))return;l.destroy()}if(t.value!=null){const u=t.value,m=f=>{u.masked=f.masked,u.unmasked=f.unmasked,u.completed=f.completed};a.onMaska=a.onMaska==null?m:Array.isArray(a.onMaska)?[...a.onMaska,m]:[a.onMaska,m]}W.set(e,new Ve(e,a))},Ae=j("p",{class:"text-subtitle-1 text-medium-emphasis mt-2 mb-2"}," Selecione os materiais necessários para a reserva do laboratório abaixo: ",-1),Ee=se({__name:"schedule-form",async setup(s){let t,e;const a=ae(),l={mask:"##/##/#### ##:##"},u=M(0),m=M(null),f=M([]),k=M([]),_=M(null),p=M(null),y=M(null),w=M(null),$=M([]),c=M({}),R=M(null),q=M(null);async function h(){c.value={};const v={scheduled_to:w.value,scheduled_from:y.value,lab_id:Number(_.value),note:p.value||""};try{await re.validate(v);const n=L(v.scheduled_from,"DD/MM/YYYY HH:mm"),o=L(v.scheduled_to,"DD/MM/YYYY HH:mm");if(!n||!o)n?o||(c.value.scheduled_to="A data de fim não pode ser inferior a data de início."):c.value.scheduled_from="A data de início não pode ser inferior a data de início.";else{if(n.unix()>o.unix())return c.value.scheduled_to="A data de fim não pode ser inferior a data de início.",!1;n.unix()===o.unix()&&(c.value.scheduled_to="A data de fim não pode ser igual a data de início.")}if(k.value.length>0){for(const{quantity:g,material_id:O}of k.value)if(await Q.validate({quantity:g,material_id:O}),!await $fetch("/api/labs/check-material-quantity",{method:"get",headers:{Authorization:`Bearer ${a.token}`},params:{quantity:g,material_id:O}}))return O.value=O,g.value=g,c.value.quantity="Não há quantidade em estoque para esta reserva.",!1}return!0}catch(n){return console.error(n),c.value[n.path]=n.message,!1}}async function b(){c.value={};const v={material_id:Number(m.value),quantity:Number(u.value)};try{return await Q.validate(v),await $fetch("/api/labs/check-material-quantity",{method:"get",headers:{Authorization:`Bearer ${a.token}`},params:v})?!0:(c.value.quantity="Não há quantidade em estoque para esta reserva.",!1)}catch(n){return c.value[n.path]=n.message,!1}}async function Y(){return await $fetch("/api/labs",{method:"get",headers:{Authorization:`Bearer ${a.token}`}})}async function V(){return await $fetch("/api/materials",{method:"get",headers:{Authorization:`Bearer ${a.token}`}})}async function D(){try{const v=L(y.value,"DD/MM/YYYY HH:mm"),n=L(w.value,"DD/MM/YYYY HH:mm"),o={scheduled_from:v==null?void 0:v.utc().format("DD/MM/YYYY HH:mm"),scheduled_to:n==null?void 0:n.utc().format("DD/MM/YYYY HH:mm"),lab_id:Number(_.value),note:p.value||"",materials:k.value};q.value=await $fetch("/api/labs/schedule",{method:"post",headers:{Authorization:`Bearer ${a.token}`},body:o})}catch(v){c.value.lab_id=v.response.statusText}}async function B(){await h()&&await D()}async function H(){if(await b()){for(const v of f.value)if(v.id==m.value){const n=[...k.value].filter(({material_id:o})=>o!==v.id);n.push({material_id:m.value,quantity:u.value,name:v.name}),k.value=n;break}}}return $.value=([t,e]=F(()=>Y()),t=await t,e(),t),f.value=([t,e]=F(()=>V()),t=await t,e(),t).filter(({quantity:v})=>v>0),(v,n)=>(x(),C(he,{class:"px-3"},{default:r(()=>[d(q)?(x(),C(E,{key:0,class:"pl-2 pr-2"},{default:r(()=>[i(A,null,{default:r(()=>[i(E,null,{default:r(()=>[i(de,{type:"info",title:"Laboratório agendado",text:"O laboratório foi agendado com sucesso!",variant:"tonal"})]),_:1}),i(E,{class:"mt-4 mb-1"},{default:r(()=>[i(z,{color:"primary",to:"/dashboard/schedules"},{default:r(()=>[N(" Ir para agenda ")]),_:1})]),_:1})]),_:1})]),_:1})):(x(),C(E,{key:1},{default:r(()=>[i(A,null,{default:r(()=>[i(E,null,{default:r(()=>[i(A,null,{default:r(()=>{var o;return[i(G,{modelValue:d(_),"onUpdate:modelValue":n[0]||(n[0]=g=>S(_)?_.value=g:null),variant:"outlined",label:"Laboratório",clearable:"",items:d($),"item-title":"name","item-value":"id","error-messages":(o=d(c))!=null&&o.lab_id?[d(c).lab_id]:""},null,8,["modelValue","items","error-messages"])]}),_:1})]),_:1}),i(E,null,{default:r(()=>[i(A,null,{default:r(()=>{var o;return[I(i(U,{variant:"outlined",modelValue:d(y),"onUpdate:modelValue":n[1]||(n[1]=g=>S(y)?y.value=g:null),clearable:"",label:"Data de início(Reserva)","error-messages":(o=d(c))!=null&&o.scheduled_from?[d(c).scheduled_from]:""},null,8,["modelValue","error-messages"]),[[d(te),void 0,l]])]}),_:1}),i(A,null,{default:r(()=>{var o;return[I(i(U,{variant:"outlined",modelValue:d(w),"onUpdate:modelValue":n[2]||(n[2]=g=>S(w)?w.value=g:null),clearable:"",label:"Data de fim(Reserva)","error-messages":(o=d(c))!=null&&o.scheduled_to?[d(c).scheduled_to]:""},null,8,["modelValue","error-messages"]),[[d(te),void 0,l]])]}),_:1})]),_:1}),i(E,null,{default:r(()=>[i(A,null,{default:r(()=>{var o;return[i(U,{variant:"outlined",modelValue:d(p),"onUpdate:modelValue":n[3]||(n[3]=g=>S(p)?p.value=g:null),clearable:"",label:"Motivo da reserva","error-messages":(o=d(c))!=null&&o.note?[d(c).note]:""},null,8,["modelValue","error-messages"])]}),_:1})]),_:1}),Ae,d(k).length>0?(x(),C(E,{key:0},{default:r(()=>[i(A,null,{default:r(()=>[i(ce,{lines:"one"},{default:r(()=>[(x(!0),le(ie,null,oe(d(k),({id:o,name:g,quantity:O},J)=>(x(),C(pe,{key:o,title:J+1+") "+g,subtitle:"quantidade: "+O},null,8,["title","subtitle"]))),128))]),_:1})]),_:1})]),_:1})):Z("",!0),i(E,null,{default:r(()=>[i(A,null,{default:r(()=>{var o;return[i(G,{variant:"outlined",label:"Material",clearable:"",modelValue:d(m),"onUpdate:modelValue":n[4]||(n[4]=g=>S(m)?m.value=g:null),items:d(f),"item-title":"name","item-value":"id","error-messages":(o=d(c))!=null&&o.material_id?[d(c).material_id]:""},null,8,["modelValue","items","error-messages"])]}),_:1}),i(A,null,{default:r(()=>{var o;return[i(U,{variant:"outlined",modelValue:d(u),"onUpdate:modelValue":n[5]||(n[5]=g=>S(u)?u.value=g:null),clearable:"",label:"Quantidade","error-messages":(o=d(c))!=null&&o.quantity?[d(c).quantity]:""},null,8,["modelValue","error-messages"])]}),_:1}),i(A,null,{default:r(()=>[i(z,{color:"primary",onClick:H},{default:r(()=>[N(" Adicionar ")]),_:1})]),_:1})]),_:1}),d(R)?(x(),C(E,{key:1},{default:r(()=>[i(A,null,{default:r(()=>[i(me,{modelValue:d(R),"onUpdate:modelValue":n[6]||(n[6]=o=>S(R)?R.value=o:null),"multi-line":""},{default:r(()=>[N(ue(d(R)),1)]),_:1},8,["modelValue"])]),_:1})]),_:1})):Z("",!0),i(E,null,{default:r(()=>[i(A,null,{default:r(()=>[i(z,{color:"primary",onClick:B},{default:r(()=>[N(" Reservar ")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))]),_:1}))}}),we=j("h6",{class:"text-h6"}," Laboratórios ",-1),Re={class:"mt-4"},Ge=se({__name:"schedule",setup(s){return ae(),(t,e)=>(x(),le(ie,null,[we,i(ke,{class:"mt-2 pb-3","max-width":"644"},{default:r(()=>[i(fe,null,{default:r(()=>[N(" Agendar laboratório ")]),_:1}),i(ve),j("div",Re,[i(Ee)])]),_:1})],64))}});export{Ge as default};
