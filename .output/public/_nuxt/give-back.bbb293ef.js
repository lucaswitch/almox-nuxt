import{n as G,A as Q,r as u,q as Y,o as n,c as r,b as l,w as c,d as x,a as f,t as v,u as a,s as B,F as g,y as N,z as $,v as R}from"./entry.a8ea04dc.js";import{u as I}from"./auth.cb07611c.js";import{a as w}from"./formatter.b9064c7a.js";import{E as O}from"./validation.977342dc.js";import{V as U,a as j}from"./VList.a955bb07.js";import{V as A}from"./VAlert.e1cd697c.js";import{d as J,b as K}from"./VCard.73ffbd1f.js";import{V as P}from"./VTextField.7b7381e2.js";import{V as L}from"./VBtn.fb6611c3.js";import"./moment.fbc5633a.js";import"./index.2e760ea7.js";import"./tag.19ec8209.js";import"./ssrBoot.73ea425f.js";import"./VImg.e08626a0.js";import"./VAvatar.28b1b839.js";import"./VDivider.bce6a8e5.js";import"./forwardRefs.d6ed2341.js";const W=f("h6",{class:"text-h6"}," Devolver materiais ",-1),X=f("b",null,"Laboratório:",-1),Z={class:"text-subtitle1"},tt={class:"text-body1"},et={class:"body2 text-medium-emphasis"},at={key:0},ot={key:0,class:"d-flex align-start mt-4 mb-6"},nt={key:1},st={key:1},wt=G({__name:"give-back",async setup(rt){let d,h;const M=Q(),y=I(),q=M.params.id,m=u({}),i=u(null),b=u([]),T=u(null),k=u(null),s=u(0),C=u([]),V=u(!1);async function H(t,o){k.value=o,T.value=t,s.value=0}async function F(t){if(await z()){const o={appointment_id:Number(i.value.id),material_id:Number(t.id),quantity:Number(s.value)};try{await $fetch("/api/labs/schedule-give-back",{method:"post",headers:{Authorization:`Bearer ${y.token}`},body:o}),C.value.push(`${t.name}(${s.value} ${t.metric.toLowerCase()}) retornados`),k.value=null,s.value=0,await D()}catch{}}}async function z(){m.value={};try{return await O.validate({amount:Number(s.value)}),Number(s.value)<0?(m.value.quantity="Você não pode devolver uma quantidade negativa.",!1):!0}catch(t){return m.value[t.path]=t.message,!1}}async function E(t){const o=await $fetch("/api/labs/schedule-view",{method:"get",headers:{Authorization:`Bearer ${y.token}`},params:{id:t}}),e=w(o.scheduled_from,"DD/MM/YYYY HH:mm"),_=w(o.scheduled_to,"DD/MM/YYYY HH:mm"),p=w(o.created_at,"DD/MM/YYYY HH:mm");return{...o,scheduledFrom:e,scheduledTo:_,createdDate:p}}async function S(t){return await $fetch("/api/labs/schedule-materials",{method:"get",headers:{Authorization:`Bearer ${y.token}`},params:{appointment_id:t}})}async function D(){b.value=(await S(q)).map(t=>(t.quantity=Number(t.quantity),t)),V.value=!1;for(const{quantity:t}of b.value)if(t<0){V.value=!0;break}}return i.value=([d,h]=Y(()=>E(q)),d=await d,h(),d),[d,h]=Y(()=>D()),await d,h(),(t,o)=>(n(),r(g,null,[W,l(K,{class:"mt-2 pb-3","max-width":"644"},{title:c(()=>[X,x(),f("span",Z,v(a(i).name),1)]),default:c(()=>[a(i)?(n(),B(J,{key:0},{default:c(()=>[f("p",tt,v(a(i).scheduledFrom)+" / "+v(a(i).scheduledTo),1),f("p",et," Criado por "+v(a(i).full_name)+" em "+v(a(i).createdDate),1),a(V)?(n(),r("div",at,[(n(!0),r(g,null,N(a(C),e=>(n(),r("div",null,[l(A,{type:"success",title:"Tudo certo!",text:e,variant:"tonal"},null,8,["text"])]))),256)),l(U,{lines:"one"},{default:c(()=>[(n(!0),r(g,null,N(a(b),e=>(n(),r("div",null,[e.quantity<0?(n(),B(j,{key:e.id,title:e.name,subtitle:"quantidade para devolver: "+e.quantity+" "+e.metric.toLowerCase()},{default:c(()=>{var _;return[a(k)===e.id?(n(),r("div",ot,[l(P,{variant:"outlined",modelValue:a(s),"onUpdate:modelValue":o[0]||(o[0]=p=>R(s)?s.value=p:null),density:"compact",label:"Quantidade retornada",type:"number",min:"0",max:e.quantity,"error-messages":(_=a(m))!=null&&_.quantity?[a(m).quantity]:""},null,8,["modelValue","max","error-messages"]),l(L,{color:"primary",variant:"tonal",class:"ml-2",onClick:p=>F(e)},{default:c(()=>[x(" Confirmar ")]),_:2},1032,["onClick"])])):(n(),r("div",nt,[l(L,{color:"primary",variant:"tonal",onClick:p=>H(e.name,e.id)},{default:c(()=>[x("Devolver material ")]),_:2},1032,["onClick"])]))]}),_:2},1032,["title","subtitle"])):$("",!0)]))),256))]),_:1})])):(n(),r("div",st,[l(A,{type:"info",title:"Tudo certo!",text:"Não há materiais para devolver restantes",variant:"tonal"})]))]),_:1})):$("",!0)]),_:1})],64))}});export{wt as default};
